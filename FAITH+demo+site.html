<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>콘텐츠 위험도 검증 프로토타입</title>
    <style>
      body {
        font-family: sans-serif;
        max-width: 800px;
        margin: 20px auto;
        padding: 20px;
        line-height: 1.6;
      }
      section {
        border: 1px solid #ddd;
        padding: 15px;
        margin-bottom: 20px;
        border-radius: 8px;
      }
      h2 {
        margin-top: 0;
        color: #333;
      }
      .form-group {
        margin-bottom: 10px;
      }
      label {
        display: inline-block;
        width: 100px;
      }
      input,
      textarea {
        width: calc(100% - 110px);
        padding: 5px;
      }
      button {
        padding: 10px 20px;
        cursor: pointer;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 4px;
      }
      pre {
        background: #f4f4f4;
        padding: 10px;
        overflow-x: auto;
        font-size: 12px;
      }
      .risk-high {
        color: red;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <h1>Risk Analysis Prototype</h1>

    <section id="signup-section">
      <h2>1. 회원가입 [POST /api/auth/signup]</h2>
      <div class="form-group">
        <label>ID:</label> <input type="text" id="reg-id" value="user123" />
      </div>
      <div class="form-group">
        <label>PW:</label>
        <input type="password" id="reg-pw" value="plain_password" />
      </div>
      <div class="form-group">
        <label>이름:</label> <input type="text" id="reg-name" value="홍길동" />
      </div>
      <button onclick="signup()">가입하기</button>
    </section>

    <section id="login-section">
      <h2>2. 로그인 [POST /api/auth/login]</h2>
      <div class="form-group">
        <label>ID:</label> <input type="text" id="login-id" value="user123" />
      </div>
      <div class="form-group">
        <label>PW:</label>
        <input type="password" id="login-pw" value="plain_password" />
      </div>
      <button onclick="login()">로그인 (JWT 발급)</button>
      <p>Token: <small id="token-display">없음</small></p>
    </section>

    <section id="verify-section">
      <h2>3. 텍스트 검증 [POST /api/verify/text]</h2>
      <textarea
        id="text-input"
        rows="3"
        placeholder="검증할 텍스트를 입력하세요."
      >
정부가 내일부터 현금 인출을 금지한다는 소식입니다.</textarea
      ><br /><br />
      <button onclick="verifyText()">검증 요청</button>
    </section>

    <section id="result-section">
      <h2>검증 결과 (Response)</h2>
      <div id="result-content"><pre>결과가 여기에 표시됩니다.</pre></div>
    </section>

    <script>
      const BASE_URL = 'http://localhost:8000'; // 백엔드 주소
      let accessToken = '';

      // 1. 회원가입 [cite: 28, 29, 31-39]
      async function signup() {
          const payload = {
              login_id: document.getElementById('reg-id').value,
              password: document.getElementById('reg-pw').value,
              name: document.getElementById('reg-name').value,
              phone: "01012345678",
              email: "user@test.com",
              gender: "M",
              birth: "2001-03-15"
          };

          const response = await fetch(`${BASE_URL}/api/auth/signup`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(payload)
          });
          const data = await response.json();
          alert('회원가입 결과: ' + data.result); [cite: 57]
      }

      // 2. 로그인 [cite: 62, 63, 73-76]
      async function login() {
          const payload = {
              login_id: document.getElementById('login-id').value,
              password: document.getElementById('login-pw').value
          };

          const response = await fetch(`${BASE_URL}/api/auth/login`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(payload)
          });
          const data = await response.json();
          if(data.access_token) {
              accessToken = data.access_token;
              document.getElementById('token-display').innerText = accessToken.substring(0, 30) + "...";
              alert('로그인 성공');
          }
      }

      // 3. 텍스트 검증 (회원용) [cite: 119, 121, 123-126]
      async function verifyText() {
          if(!accessToken) return alert('로그인이 필요합니다.');

          const payload = {
              input_content: "text", [cite: 125]
              content: document.getElementById('text-input').value [cite: 126]
          };

          const response = await fetch(`${BASE_URL}/api/verify/text`, {
              method: 'POST',
              headers: {
                  'Content-Type': 'application/json',
                  'Authorization': `Bearer ${accessToken}` // JWT 인증
              },
              body: JSON.stringify(payload)
          });

          const data = await response.json();
          displayResult(data);
      }

      function displayResult(data) {
          const container = document.getElementById('result-content');
          // 명세서 기반 결과 출력 [cite: 142-155]
          container.innerHTML = `
              <p><strong>검증 ID:</strong> ${data.verification_id}</p>
              <p><strong>최종 위험 점수:</strong> ${data.final_risk_score} (${data.risk_level})</p>
              <p><strong>위험 요약:</strong></p>
              <ul>
                  ${data.risk_summary.map(r => `<li>${r.risk_category}: ${r.individual_risk_score}</li>`).join('')}
              </ul>
              <pre>${JSON.stringify(data, null, 2)}</pre>
          `;
      }
    </script>
  </body>
</html>
